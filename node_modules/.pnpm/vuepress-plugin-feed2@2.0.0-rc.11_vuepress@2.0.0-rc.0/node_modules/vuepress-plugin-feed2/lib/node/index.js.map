{"version":3,"file":"index.js","sources":["../../src/node/compact.ts","../../src/node/utils/encodeXML.ts","../../src/node/utils/helper.ts","../../src/node/generator/atom/index.ts","../../src/node/generator/json/index.ts","../../src/node/generator/rss/index.ts","../../src/node/generator/feed.ts","../../src/node/extractor/content.ts","../../src/node/extractor/getter.ts","../../src/node/options.ts","../../src/node/generator/generator.ts","../../src/node/injectHead.ts","../../src/node/plugin.ts"],"sourcesContent":["import { createConverter, isPlainObject } from \"vuepress-shared/node\";\n\nimport type { FeedOptions } from \"./typings/index.js\";\n\n/** @deprecated */\nexport const convertOptions = (\n  options: FeedOptions &\n    Record<string, unknown> & {\n      output?: {\n        atom?: { enable?: boolean; path?: string };\n        json?: { enable?: boolean; path?: string };\n        rss?: { enable?: boolean; path?: string };\n      };\n    },\n): void => {\n  const { deprecatedLogger, droppedLogger } = createConverter(\"feed2\");\n  const output = options[\"output\"];\n\n  if (isPlainObject(output)) {\n    options.atom = output.atom?.enable ?? false;\n    options.json = output.json?.enable ?? false;\n    options.rss = output.rss?.enable ?? false;\n    options.atomOutputFilename = output.atom?.path ?? \"atom.xml\";\n    options.jsonOutputFilename = output.json?.path ?? \"feed.json\";\n    options.rssOutputFilename = output.rss?.path ?? \"rss.xml\";\n  }\n\n  deprecatedLogger({\n    options,\n    old: \"customElements\",\n    new: \"preservedElements\",\n  });\n  deprecatedLogger({\n    options,\n    old: \"removedElements\",\n    new: \"preservedElements\",\n  });\n\n  droppedLogger({\n    options,\n    old: \"output\",\n  });\n};\n","import {\n  encodeCDATA,\n  encodeXMLContent,\n  entries,\n  fromEntries,\n  isArray,\n  isPlainObject,\n} from \"vuepress-shared/node\";\nimport type { ElementCompact } from \"xml-js\";\n\nexport const encodeXML = (content: ElementCompact): ElementCompact =>\n  fromEntries(\n    entries(content).map(([key, value]) => {\n      if (key === \"_attributes\" && value)\n        return [\n          key,\n          fromEntries(\n            entries(value as Record<string, string | number | undefined>).map(\n              ([key, value]) => [\n                key,\n                value ? encodeXMLContent(value.toString()) : undefined,\n              ],\n            ),\n          ),\n        ];\n\n      if (key === \"_text\")\n        return [key, encodeXMLContent((value as string | number).toString())];\n      if (key === \"_cdata\") return [key, encodeCDATA(value as string)];\n      if (key === \"_comment\" || key === \"_instruction\") return [key, value];\n\n      if (isArray(value))\n        return [key, value.map((item) => encodeXML(item as ElementCompact))];\n\n      if (isPlainObject(value))\n        return [key, encodeXML(value as ElementCompact)];\n\n      return [key, encodeXMLContent(String(value))];\n    }),\n  ) satisfies ElementCompact;\n","import {\n  Logger,\n  isLinkHttp,\n  removeEndingSlash,\n  removeLeadingSlash,\n} from \"vuepress-shared/node\";\n\nexport const FEED_GENERATOR = \"vuepress-plugin-feed2\";\n\nexport const logger = new Logger(FEED_GENERATOR);\n\nexport const resolveUrl = (hostname: string, base = \"\", path = \"\"): string =>\n  `${\n    isLinkHttp(hostname)\n      ? removeEndingSlash(hostname)\n      : `https://${removeEndingSlash(hostname)}`\n  }${base}${removeLeadingSlash(path)}`;\n\nexport const getImageMineType = (ext = \"\"): string =>\n  `image/${\n    ext === \"jpg\"\n      ? \"jpeg\"\n      : ext === \"svg\"\n        ? \"svg+xml\"\n        : ext === \"jpeg\" ||\n            ext === \"png\" ||\n            ext === \"bmp\" ||\n            ext === \"gif\" ||\n            ext === \"webp\"\n          ? ext\n          : \"\"\n  }`;\n","import { isArray } from \"vuepress-shared/node\";\nimport { js2xml } from \"xml-js\";\n\nimport type {\n  AtomAuthor,\n  AtomCategory,\n  AtomContent,\n  AtomEntry,\n} from \"./typings.js\";\nimport type { FeedAuthor, FeedCategory } from \"../../typings/index.js\";\nimport { FEED_GENERATOR, encodeXML } from \"../../utils/index.js\";\nimport type { Feed } from \"../feed.js\";\n\nconst getAuthor = (author: FeedAuthor): AtomAuthor => {\n  const { name = \"Unknown\", email, url } = author;\n\n  return {\n    name,\n    ...(email ? { email } : {}),\n    ...(url ? { uri: url } : {}),\n  };\n};\n\nconst genCategory = (category: FeedCategory): AtomCategory => {\n  const { name, scheme = \"\" } = category;\n\n  return {\n    _attributes: {\n      term: name,\n      scheme,\n    },\n  };\n};\n\n/**\n * Returns an Atom 1.0 feed\n *\n * @see http://www.atomenabled.org/developers/syndication/\n */\nexport const renderAtom = (feed: Feed): string => {\n  const { channel, links } = feed.options;\n\n  const content: AtomContent = {\n    _declaration: {\n      _attributes: {\n        version: \"1.0\",\n        encoding: \"utf-8\",\n      },\n    },\n    _instruction: {\n      \"xml-stylesheet\": `type=\"text/xsl\" href=\"${links.atomXsl}\"`,\n    },\n    feed: {\n      _attributes: {\n        xmlns: \"http://www.w3.org/2005/Atom\",\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        ...(channel.language ? { \"xml:lang\": channel.language } : {}),\n      },\n      id: channel.link,\n      title: channel.title,\n\n      ...(channel.description ? { subtitle: channel.description } : {}),\n      ...(channel.author\n        ? {\n            author: isArray(channel.author)\n              ? channel.author.map((author) => getAuthor(author))\n              : [getAuthor(channel.author)],\n          }\n        : {}),\n      ...(channel.icon ? { icon: channel.icon } : {}),\n      ...(channel.image ? { logo: channel.image } : {}),\n      ...(channel.copyright ? { rights: channel.copyright } : {}),\n\n      updated: channel.lastUpdated\n        ? channel.lastUpdated.toISOString()\n        : new Date().toISOString(),\n      generator: FEED_GENERATOR,\n      link: [{ _attributes: { rel: \"self\", href: links.atom } }],\n    },\n  };\n\n  if (channel.link)\n    content.feed.link.push({\n      _attributes: { rel: \"alternate\", href: channel.link },\n    });\n\n  if (channel.hub)\n    content.feed.link.push({\n      _attributes: { rel: \"hub\", href: channel.hub },\n    });\n\n  if (channel.image) content.feed.logo = channel.image;\n\n  if (channel.icon) content.feed.icon = channel.icon;\n\n  if (channel.copyright) content.feed.rights = channel.copyright;\n\n  content.feed.category = Array.from(feed.categories).map((category) => ({\n    _attributes: { term: category },\n  }));\n\n  content.feed.contributor = Array.from(feed.contributors)\n    .filter((contributor) => contributor.name)\n    .map((contributor) => getAuthor(contributor));\n\n  /**\n   * \"entry\" nodes\n   */\n  content.feed.entry = feed.items.map((item) => {\n    // entry: required elements\n    const entry: AtomEntry = {\n      title: { _attributes: { type: \"text\" }, _text: item.title },\n      id: item.guid || item.link,\n      link: { _attributes: { href: item.link } },\n      updated: item.lastUpdated.toISOString(),\n    };\n\n    // entry: recommended elements\n    if (item.summary)\n      entry.summary = {\n        _attributes: { type: \"html\" },\n        _cdata: item.summary,\n      };\n    else if (item.description)\n      entry.summary = {\n        _attributes: { type: \"text\" },\n        _text: item.description,\n      };\n\n    if (item.content)\n      entry.content = {\n        _attributes: { type: \"html\" },\n        _cdata: item.content,\n      };\n\n    // author(s)\n    if (item.author)\n      entry.author = item.author\n        .filter((author) => author.name)\n        .map((author) => getAuthor(author));\n\n    if (item.category)\n      // category\n      entry.category = item.category.map((category) => genCategory(category));\n\n    // contributor\n    if (item.contributor)\n      entry.contributor = item.contributor.map((contributor) =>\n        getAuthor(contributor),\n      );\n\n    // published\n    if (item.pubDate) entry.published = item.pubDate.toISOString();\n\n    // rights\n    if (item.copyright) entry.rights = item.copyright;\n\n    return entry;\n  });\n\n  return js2xml(encodeXML(content), {\n    compact: true,\n    ignoreComment: true,\n    spaces: 2,\n  });\n};\n","/* eslint-disable @typescript-eslint/naming-convention */\nimport { isArray } from \"vuepress-shared/node\";\n\nimport type { JSONAuthor, JSONContent, JSONItem } from \"./typings.js\";\nimport type { FeedAuthor } from \"../../typings/index.js\";\nimport type { Feed } from \"../feed.js\";\n\nconst formatAuthor = (author: FeedAuthor): JSONAuthor => ({\n  name: author.name!,\n  ...(author.url ? { url: author.url } : {}),\n  ...(author.avatar ? { avatar: author.avatar } : {}),\n});\n\n/**\n * JSON 1.1 feed\n *\n * @see https://jsonfeed.org/version/1.1\n */\nexport const renderJSON = (feed: Feed): string => {\n  const { channel, links } = feed.options;\n\n  const content: JSONContent = {\n    version: \"https://jsonfeed.org/version/1.1\",\n    title: channel.title,\n    home_page_url: channel.link,\n    feed_url: links.json,\n  };\n\n  if (channel.description) content.description = channel.description;\n\n  if (channel.image) content.icon = channel.image;\n  if (channel.icon) content.favicon = channel.icon;\n\n  const channelAuthors = (\n    isArray(channel.author)\n      ? channel.author\n      : channel.author\n        ? [channel.author]\n        : []\n  ).filter((author) => Boolean(author?.name));\n\n  if (channelAuthors.length)\n    content.authors = channelAuthors.map((author) => formatAuthor(author));\n\n  content.items = feed.items.map((item) => {\n    const feedItem: JSONItem = {\n      title: item.title,\n      url: item.link,\n      id: item.guid || item.link,\n      ...(item.description ? { summary: item.description } : {}),\n\n      // json_feed distinguishes between html and text content\n      // but since we only take a single type, we'll assume HTML\n      content_html: item.content,\n    };\n\n    if (item.image) feedItem.image = item.image;\n\n    if (item.pubDate) feedItem.date_published = item.pubDate.toISOString();\n\n    if (item.lastUpdated)\n      feedItem.date_modified = item.lastUpdated.toISOString();\n\n    // author\n    if (isArray(item.author))\n      feedItem.authors = item.author\n        .filter((author) => author.name)\n        .map((author) => formatAuthor(author));\n\n    // tags\n    if (item.category)\n      feedItem.tags = item.category\n        .filter((category) => category.name)\n        .map((category) => category.name);\n\n    return feedItem;\n  });\n\n  return JSON.stringify(content, null, 2);\n};\n","import { isUrl } from \"vuepress-shared/node\";\nimport { js2xml } from \"xml-js\";\n\nimport type {\n  RSSCategory,\n  RSSContent,\n  RSSEnclosure,\n  RSSGuid,\n  RSSItem,\n} from \"./typings.js\";\nimport type {\n  FeedCategory,\n  FeedEnclosure,\n  FeedItemInformation,\n} from \"../../typings/index.js\";\nimport { FEED_GENERATOR, encodeXML } from \"../../utils/index.js\";\nimport type { Feed } from \"../feed.js\";\n\nconst genCategory = (category: FeedCategory): RSSCategory => {\n  const { name, domain } = category;\n\n  return {\n    _text: name,\n    ...(domain ? { _attributes: { domain } } : {}),\n  };\n};\n\nconst genGuid = (item: FeedItemInformation): RSSGuid => {\n  const guid = item.guid || item.link;\n\n  return {\n    ...(isUrl(guid)\n      ? {}\n      : {\n          _attributes: {\n            isPermaLink: \"false\",\n          },\n        }),\n    _text: guid,\n  };\n};\n\nconst genEnclosure = (enclosure: FeedEnclosure): RSSEnclosure => ({\n  _attributes: {\n    url: enclosure.url,\n    ...(enclosure.length ? { length: enclosure.length } : {}),\n    ...(enclosure.type ? { type: enclosure.type } : {}),\n  },\n});\n\n/**\n * Returns a RSS 2.0 feed\n *\n * @see https://validator.w3.org/feed/docs/rss2.html\n */\nexport const renderRSS = (feed: Feed): string => {\n  const { links, channel } = feed.options;\n  let hasContent = false;\n\n  const content: RSSContent = {\n    _declaration: { _attributes: { version: \"1.0\", encoding: \"utf-8\" } },\n    _instruction: {\n      \"xml-stylesheet\": `type=\"text/xsl\" href=\"${links.rssXsl}\"`,\n    },\n    rss: {\n      _attributes: {\n        version: \"2.0\",\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        \"xmlns:atom\": \"http://www.w3.org/2005/Atom\",\n      },\n      channel: {\n        /**\n         * @see http://validator.w3.org/feed/docs/warning/MissingAtomSelfLink.html\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        \"atom:link\": {\n          _attributes: {\n            href: links.rss,\n            rel: \"self\",\n            type: \"application/rss+xml\",\n          },\n        },\n        title: { _text: channel.title },\n        link: { _text: channel.link },\n        description: { _text: channel.description },\n        language: { _text: channel.language },\n        pubDate: {\n          _text: channel.pubDate\n            ? channel.pubDate.toUTCString()\n            : new Date().toUTCString(),\n        },\n        lastBuildDate: {\n          _text: channel.lastUpdated\n            ? channel.lastUpdated.toUTCString()\n            : new Date().toUTCString(),\n        },\n        generator: { _text: FEED_GENERATOR },\n        docs: {\n          _text: \"https://validator.w3.org/feed/docs/rss2.html\",\n        },\n      },\n    },\n  };\n\n  if (channel.copyright)\n    content.rss.channel.copyright = { _text: channel.copyright };\n\n  if (channel.ttl) content.rss.channel.ttl = { _text: channel.ttl.toString() };\n\n  if (channel.image)\n    content.rss.channel.image = {\n      title: { _text: channel.title },\n      url: { _text: channel.image },\n      link: { _text: channel.link },\n    };\n\n  /**\n   * Channel Categories\n   *\n   * @see https://validator.w3.org/feed/docs/rss2.html#comments\n   */\n  content.rss.channel.category = Array.from(feed.categories).map(\n    (category) => ({ _text: category }),\n  );\n\n  /**\n   * Channel Categories\n   *\n   * @see https://validator.w3.org/feed/docs/rss2.html#hrelementsOfLtitemgt\n   */\n  content.rss.channel.item = feed.items.map((entry) => {\n    const item: RSSItem = {\n      title: { _text: entry.title },\n      link: { _text: entry.link },\n      guid: genGuid(entry),\n      source: {\n        _attributes: { url: links.rss },\n        _text: entry.title,\n      },\n    };\n\n    if (entry.description)\n      item.description = {\n        _text: entry.description,\n      };\n\n    /**\n     * Item Author\n     */\n    if (entry.author) {\n      const author = entry.author.find((author) => author.email && author.name);\n\n      if (author)\n        item.author = {\n          _text: `${author.email!} (${author.name!})`,\n        };\n    }\n\n    /**\n     * Item Category\n     *\n     * @see https://validator.w3.org/feed/docs/rss2.html#ltcategorygtSubelementOfLtitemgt\n     */\n    if (entry.category)\n      item.category = entry.category\n        .filter((category) => category.name)\n        .map((category) => genCategory(category));\n\n    if (entry.comments) item.comments = { _text: entry.link };\n\n    if (entry.pubDate) item.pubDate = { _text: entry.pubDate.toUTCString() };\n\n    if (entry.content) {\n      hasContent = true;\n      item[\"content:encoded\"] = { _cdata: entry.content };\n    }\n\n    /**\n     * Item Enclosure\n     *\n     * @see https://validator.w3.org/feed/docs/rss2.html#ltenclosuregtSubelementOfLtitemgt\n     */\n    if (entry.enclosure) item.enclosure = genEnclosure(entry.enclosure);\n\n    return item;\n  });\n\n  if (hasContent) {\n    content.rss._attributes[\"xmlns:content\"] =\n      \"http://purl.org/rss/1.0/modules/content/\";\n    content.rss._attributes[\"xmlns:dc\"] = \"http://purl.org/dc/elements/1.1/\";\n  }\n\n  return js2xml(encodeXML(content), {\n    compact: true,\n    ignoreComment: true,\n    spaces: 2,\n  });\n};\n","import { renderAtom } from \"./atom/index.js\";\nimport { renderJSON } from \"./json/index.js\";\nimport { renderRSS } from \"./rss/index.js\";\nimport type {\n  FeedContributor,\n  FeedInitOptions,\n  FeedItemInformation,\n} from \"../typings/index.js\";\n\nexport class Feed {\n  items: FeedItemInformation[] = [];\n\n  categories = new Set<string>();\n\n  private _contributorKeys = new Set<string>();\n\n  contributors: FeedContributor[] = [];\n\n  constructor(public options: FeedInitOptions) {}\n\n  /**\n   * Add a feed item\n   */\n  public addItem = (item: FeedItemInformation): void => {\n    this.items.push(item);\n  };\n\n  /**\n   * Add a category\n   */\n  public addCategory = (category: string): void => {\n    this.categories.add(category);\n  };\n\n  /**\n   * Add a contributor\n   */\n  public addContributor = (contributor: FeedContributor): void => {\n    // use keys to avoid adding same contributor\n    const key = contributor.email || contributor.name;\n\n    if (key && !this._contributorKeys.has(key)) {\n      this._contributorKeys.add(key);\n      this.contributors.push(contributor);\n    }\n  };\n\n  /**\n   * Returns a Atom 1.0 feed\n   */\n  public atom = (): string => renderAtom(this);\n\n  /**\n   * Returns a RSS 2.0 feed\n   */\n  public rss = (): string => renderRSS(this);\n\n  /**\n   * Returns a JSON 1.1 feed\n   */\n  public json = (): string => renderJSON(this);\n}\n","import type { App, Page } from \"@vuepress/core\";\nimport { fs } from \"@vuepress/utils\";\nimport type { AnyNode } from \"cheerio\";\nimport { load } from \"cheerio\";\nimport {\n  HTML_TAGS,\n  MATHML_TAGS,\n  SVG_TAGS,\n  isAbsoluteUrl,\n  isArray,\n  isLinkHttp,\n  removeEndingSlash,\n} from \"vuepress-shared/node\";\n\nconst HEADING_TAGS = [\"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"];\n\nconst handleNode = (\n  node: AnyNode,\n  base: string,\n  isPreservedElement: (tagName: string) => boolean,\n): AnyNode | null => {\n  if (node.type === \"tag\") {\n    // image using relative urls shall be dropped\n    if (node.tagName === \"img\") {\n      const { src } = node.attribs;\n\n      // this is not a resolvable image link\n      if (!isLinkHttp(src) && !isAbsoluteUrl(src)) return null;\n    }\n\n    // toc should be dropped\n    if (\n      [node.attribs[\"class\"], node.attribs[\"id\"]].some((item) =>\n        [\"table-of-contents\", \"toc\"].includes(item),\n      )\n    )\n      return null;\n\n    // remove code block\n    if (node.tagName === \"pre\") return null;\n\n    // standard tags can be returned\n    if (\n      HTML_TAGS.includes(node.tagName) ||\n      SVG_TAGS.includes(node.tagName) ||\n      MATHML_TAGS.includes(node.tagName)\n    ) {\n      // remove heading id tabindex and anchor inside\n      if (HEADING_TAGS.includes(node.tagName)) {\n        delete node.attribs[\"id\"];\n        delete node.attribs[\"tabindex\"];\n        node.children = node.children.filter(\n          (child) =>\n            child.type !== \"tag\" ||\n            child.tagName !== \"a\" ||\n            child.attribs[\"class\"] !== \"header-anchor\",\n        );\n      }\n\n      // remove `v-pre` attribute\n      if (node.tagName === \"code\") delete node.attribs[\"v-pre\"];\n\n      node.children = handleNodes(node.children, base, isPreservedElement);\n\n      return node;\n    }\n\n    // we shall convert `<RouterLink>` and `<VPLink>` to `<a>` tag\n    if (node.tagName === \"routerlink\" || node.tagName === \"vplink\") {\n      node.tagName = \"a\";\n      node.attribs[\"href\"] = `${removeEndingSlash(base)}${node.attribs[\"to\"]}`;\n      node.attribs[\"target\"] = \"blank\";\n      delete node.attribs[\"to\"];\n      node.children = handleNodes(node.children, base, isPreservedElement);\n\n      return node;\n    }\n\n    if (isPreservedElement(node.tagName)) return node;\n\n    // other unknown tags and will be dropped\n    return null;\n  }\n\n  return node;\n};\n\nconst handleNodes = (\n  nodes: AnyNode[] | null,\n  base: string,\n  isPreservedElement: (tagName: string) => boolean,\n): AnyNode[] =>\n  isArray(nodes)\n    ? nodes\n        .map((node) => handleNode(node, base, isPreservedElement))\n        .filter((node): node is AnyNode => node !== null)\n    : [];\n\nconst $ = load(\"\");\n\nexport const getPageRenderContent = (\n  app: App,\n  page: Page,\n  isPreservedElement: (tagName: string) => boolean,\n): string => {\n  const pagePath = app.dir.dest(page.path);\n  const pageContent = fs.existsSync(pagePath)\n    ? fs.readFileSync(pagePath, \"utf-8\")\n    : page.contentRendered;\n\n  let content = \"\";\n  const rootNodes = $.parseHTML(pageContent) || [];\n\n  for (const node of rootNodes) {\n    const resolvedNode = handleNode(node, app.options.base, isPreservedElement);\n\n    if (resolvedNode) content += `${$.html(resolvedNode)}`;\n  }\n\n  return content;\n};\n","import type { App, Page, PageFrontmatter } from \"@vuepress/core\";\nimport type { GitData } from \"@vuepress/plugin-git\";\nimport type { AuthorInfo } from \"vuepress-shared/node\";\nimport {\n  getAuthor,\n  getCategory,\n  getPageExcerpt,\n  getPageText,\n  isAbsoluteUrl,\n  isArray,\n  isFunction,\n  isPlainObject,\n  isUrl,\n} from \"vuepress-shared/node\";\n\nimport { getPageRenderContent } from \"./content.js\";\nimport type { Feed } from \"../generator/feed.js\";\nimport type {\n  FeedAuthor,\n  FeedCategory,\n  FeedContributor,\n  FeedEnclosure,\n  FeedFrontmatterOption,\n  FeedGetter,\n  FeedItemInformation,\n  FeedOptions,\n  FeedPluginFrontmatter,\n} from \"../typings/index.js\";\nimport { getImageMineType, resolveUrl } from \"../utils/index.js\";\n\nexport class FeedInfo {\n  private pageOptions: FeedFrontmatterOption;\n  private frontmatter: PageFrontmatter<FeedPluginFrontmatter>;\n  private base: string;\n  private getter: FeedGetter;\n  private isPreservedElement: (tagName: string) => boolean;\n\n  constructor(\n    private app: App,\n    private options: FeedOptions,\n    private page: Page<\n      { excerpt?: string; git?: GitData },\n      FeedPluginFrontmatter\n    >,\n    private feed: Feed,\n  ) {\n    this.base = this.app.options.base;\n    this.frontmatter = page.frontmatter;\n    this.getter = options.getter || {};\n    this.pageOptions = this.frontmatter.feed || {};\n    this.isPreservedElement = (tagName): boolean => {\n      const { preservedElements } = this.options;\n\n      return isArray(preservedElements)\n        ? preservedElements.some((item) =>\n            item instanceof RegExp ? item.test(tagName) : item === tagName,\n          )\n        : isFunction(preservedElements)\n          ? preservedElements(tagName)\n          : false;\n    };\n  }\n\n  get title(): string {\n    if (isFunction(this.getter.title)) return this.getter.title(this.page);\n\n    return this.pageOptions.title || this.page.title;\n  }\n\n  /** real url */\n  get link(): string {\n    if (isFunction(this.getter.link)) return this.getter.link(this.page);\n\n    return resolveUrl(this.options.hostname, this.base, this.page.path);\n  }\n\n  get description(): string | null {\n    if (isFunction(this.getter.description))\n      return this.getter.description(this.page);\n\n    if (this.pageOptions.description) return this.pageOptions.description;\n\n    if (this.frontmatter.description) return this.frontmatter.description;\n\n    const pageText = getPageText(this.page);\n\n    return pageText.length > 180 ? `${pageText.slice(0, 177)}...` : pageText;\n  }\n\n  get author(): FeedAuthor[] {\n    if (isFunction(this.getter.author)) return this.getter.author(this.page);\n\n    if (isArray(this.pageOptions.author)) return this.pageOptions.author;\n\n    if (isPlainObject(this.pageOptions.author))\n      return [this.pageOptions.author];\n\n    return this.frontmatter.author === false\n      ? []\n      : this.frontmatter.author\n        ? getAuthor(this.frontmatter.author)\n        : this.options.channel?.author\n          ? getAuthor(<AuthorInfo>this.options.channel?.author)\n          : [];\n  }\n\n  get category(): FeedCategory[] | null {\n    if (isFunction(this.getter.category))\n      return this.getter.category(this.page);\n\n    if (isArray(this.pageOptions.category)) return this.pageOptions.category;\n\n    if (isPlainObject(this.pageOptions.category))\n      return [this.pageOptions.category];\n\n    const { categories, category = categories } = this.frontmatter;\n\n    return getCategory(category).map((item) => ({ name: item }));\n  }\n\n  get enclosure(): FeedEnclosure | null {\n    if (isFunction(this.getter.enclosure))\n      return this.getter.enclosure(this.page);\n\n    if (this.image)\n      return {\n        url: this.image,\n        type: getImageMineType(this.image.split(\".\").pop()),\n      };\n\n    return null;\n  }\n\n  get guid(): string {\n    return this.pageOptions.guid || this.link;\n  }\n\n  get pubDate(): Date | null {\n    if (isFunction(this.getter.publishDate))\n      return this.getter.publishDate(this.page);\n\n    const { time, date = time } = this.page.frontmatter;\n\n    const { createdTime } = this.page.data.git || {};\n\n    return date && date instanceof Date\n      ? date\n      : createdTime\n        ? new Date(createdTime)\n        : null;\n  }\n\n  get lastUpdated(): Date {\n    if (isFunction(this.getter.lastUpdateDate))\n      return this.getter.lastUpdateDate(this.page);\n\n    const { updatedTime } = this.page.data.git || {};\n\n    return updatedTime ? new Date(updatedTime) : new Date();\n  }\n\n  get excerpt(): string | null {\n    if (isFunction(this.getter.excerpt)) return this.getter.excerpt(this.page);\n\n    if (this.pageOptions.summary) return this.pageOptions.summary;\n\n    return getPageExcerpt(this.app, this.page, {\n      isCustomElement: this.isPreservedElement,\n    });\n  }\n\n  get content(): string {\n    if (isFunction(this.getter.content)) return this.getter.content(this.page);\n\n    if (this.pageOptions.content) return this.pageOptions.content;\n\n    return getPageRenderContent(this.app, this.page, this.isPreservedElement);\n  }\n\n  get image(): string | null {\n    if (isFunction(this.getter.image)) return this.getter.image(this.page);\n\n    const { banner, cover } = this.frontmatter;\n\n    if (banner) {\n      if (isAbsoluteUrl(banner))\n        return resolveUrl(this.options.hostname, this.app.options.base, banner);\n\n      if (isUrl(banner)) return banner;\n    }\n\n    if (cover) {\n      if (isAbsoluteUrl(cover))\n        return resolveUrl(this.options.hostname, this.app.options.base, cover);\n\n      if (isUrl(cover)) return cover;\n    }\n\n    const result = /!\\[.*?\\]\\((.*?)\\)/iu.exec(this.page.content);\n\n    if (result) {\n      if (isAbsoluteUrl(result[1]))\n        return resolveUrl(\n          this.options.hostname,\n          this.app.options.base,\n          result[1],\n        );\n\n      if (isUrl(result[1])) return result[1];\n    }\n\n    return null;\n  }\n\n  get contributor(): FeedContributor[] {\n    if (isFunction(this.getter.contributor))\n      return this.getter.contributor(this.page);\n\n    if (isArray(this.pageOptions.contributor))\n      return this.pageOptions.contributor;\n\n    if (isPlainObject(this.pageOptions.contributor))\n      return [this.pageOptions.contributor];\n\n    return this.author;\n  }\n\n  get copyright(): string | null {\n    if (isFunction(this.getter.copyright))\n      return this.getter.copyright(this.page);\n\n    if (this.frontmatter.copyright) return this.frontmatter.copyright;\n    const firstAuthor = this.author[0];\n\n    if (firstAuthor?.name) return `Copyright by ${firstAuthor.name}`;\n\n    return null;\n  }\n\n  getFeedItem(): FeedItemInformation | null {\n    const {\n      author,\n      category,\n      content,\n      contributor,\n      copyright,\n      description,\n      enclosure,\n      excerpt,\n      guid,\n      image,\n      lastUpdated,\n      link,\n      pubDate,\n      title,\n    } = this;\n\n    // we need at least title or description\n    if (!title && !description) return null;\n\n    // add category to feed\n    if (category) category.forEach((item) => this.feed.addCategory(item.name));\n\n    // add contributor to feed\n    if (contributor)\n      contributor.forEach((item) => this.feed.addContributor(item));\n\n    return {\n      title,\n      link,\n      guid,\n      lastUpdated,\n      content,\n      author,\n      contributor,\n      ...(description ? { description } : {}),\n      ...(excerpt ? { summary: excerpt } : {}),\n      ...(category ? { category } : {}),\n      ...(enclosure ? { enclosure } : {}),\n      ...(pubDate ? { pubDate } : {}),\n      ...(image ? { image } : {}),\n      ...(copyright ? { copyright } : {}),\n    };\n  }\n}\n","import type { App, Page } from \"@vuepress/core\";\nimport type { GitData } from \"@vuepress/plugin-git\";\nimport { getDirname, path } from \"@vuepress/utils\";\nimport {\n  compareDate,\n  deepAssign,\n  ensureEndingSlash,\n  fromEntries,\n  isArray,\n  isLinkHttp,\n  keys,\n  removeEndingSlash,\n  removeLeadingSlash,\n  values,\n} from \"vuepress-shared/node\";\n\nimport type {\n  BaseFeedOptions,\n  FeedChannelOption,\n  FeedLinks,\n  FeedOptions,\n} from \"./typings/index.js\";\nimport { resolveUrl } from \"./utils/index.js\";\n\nconst __dirname = getDirname(import.meta.url);\n\nconst TEMPLATE_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../../templates\"),\n);\n\nexport interface ResolvedFeedOptions\n  extends Omit<BaseFeedOptions, \"sorter\" | \"filter\">,\n    Required<Pick<BaseFeedOptions, \"sorter\" | \"filter\">> {\n  hostname: string;\n}\n\nexport type ResolvedFeedOptionsMap = Record<string, ResolvedFeedOptions>;\n\nexport const ensureHostName = (options: Partial<FeedOptions>): boolean => {\n  // make sure hostname do not end with `/`\n  if (options.hostname) {\n    options.hostname = isLinkHttp(options.hostname)\n      ? removeEndingSlash(options.hostname)\n      : `https://${removeEndingSlash(options.hostname)}`;\n\n    return true;\n  }\n\n  return false;\n};\n\nexport const checkOutput = (options: Partial<FeedOptions>): boolean =>\n  // some locales request output\n  (options.locales &&\n    values(options.locales).some(\n      ({ atom, json, rss }) => atom || json || rss,\n    )) ||\n  // root option requests output\n  Boolean(options.atom || options.json || options.rss);\n\nexport const getFeedOptions = (\n  { siteData }: App,\n  options: FeedOptions,\n): ResolvedFeedOptionsMap =>\n  fromEntries(\n    keys({\n      // root locale must exists\n      // eslint-disable-next-line @typescript-eslint/naming-convention\n      \"/\": {},\n      ...siteData.locales,\n    }).map((localePath) => [\n      localePath,\n      <ResolvedFeedOptions>{\n        // default values\n        filter: ({ frontmatter, filePathRelative }: Page): boolean =>\n          !(\n            frontmatter[\"home\"] ||\n            !filePathRelative ||\n            frontmatter[\"article\"] === false ||\n            frontmatter[\"feed\"] === false\n          ),\n        sorter: (\n          pageA: Page<{ git?: GitData }, Record<string, never>>,\n          pageB: Page<{ git?: GitData }, Record<string, never>>,\n        ): number =>\n          compareDate(\n            pageA.data.git?.createdTime\n              ? new Date(pageA.data.git?.createdTime)\n              : pageA.frontmatter.date,\n            pageB.data.git?.createdTime\n              ? new Date(pageB.data.git?.createdTime)\n              : pageB.frontmatter.date,\n          ),\n        ...options,\n        ...options.locales?.[localePath],\n\n        // make sure hostname is not been override\n        hostname: options.hostname,\n      },\n    ]),\n  );\n\nexport const getFeedChannelOption = (\n  app: App,\n  options: FeedOptions,\n  localePath = \"\",\n): FeedChannelOption => {\n  const { base } = app.options;\n  const { title, description, lang, locales } = app.siteData;\n  const { channel = {}, hostname, icon, image } = options;\n  const authorName = isArray(options.channel?.author)\n    ? options.channel?.author[0]?.name\n    : options.channel?.author?.name;\n\n  const defaultChannelOption: FeedChannelOption = {\n    title: locales[localePath]?.title || title || locales[\"/\"]?.title || \"\",\n    link: resolveUrl(hostname, base, localePath),\n    description:\n      locales[localePath]?.description ||\n      description ||\n      locales[\"/\"]?.description ||\n      \"\",\n    language: locales[localePath]?.lang || lang,\n    copyright: authorName ? `Copyright by ${authorName}` : \"\",\n    pubDate: new Date(),\n    lastUpdated: new Date(),\n    ...(icon\n      ? { icon: isLinkHttp(icon) ? icon : resolveUrl(hostname, base, icon) }\n      : {}),\n    ...(image\n      ? { image: isLinkHttp(image) ? image : resolveUrl(hostname, base, image) }\n      : {}),\n  };\n\n  return deepAssign(defaultChannelOption, channel, {\n    ...(channel.icon\n      ? {\n          icon: isLinkHttp(channel.icon)\n            ? channel.icon\n            : resolveUrl(hostname, base, channel.icon),\n        }\n      : {}),\n    ...(channel.image\n      ? {\n          image: isLinkHttp(channel.image)\n            ? channel.image\n            : resolveUrl(hostname, base, channel.image),\n        }\n      : {}),\n  });\n};\n\nexport const getFilename = (\n  options: ResolvedFeedOptions,\n  prefix = \"/\",\n): Required<\n  Pick<\n    FeedOptions,\n    | \"atomOutputFilename\"\n    | \"atomXslFilename\"\n    | \"atomXslTemplate\"\n    | \"jsonOutputFilename\"\n    | \"rssOutputFilename\"\n    | \"rssXslFilename\"\n    | \"rssXslTemplate\"\n  >\n> => ({\n  atomOutputFilename: `${removeLeadingSlash(prefix)}${\n    options.atomOutputFilename || \"atom.xml\"\n  }`,\n  atomXslFilename: `${removeLeadingSlash(prefix)}${\n    options.atomXslFilename || \"atom.xsl\"\n  }`,\n  atomXslTemplate: options.atomXslTemplate || `${TEMPLATE_FOLDER}atom.xsl`,\n  jsonOutputFilename: `${removeLeadingSlash(prefix)}${\n    options.jsonOutputFilename || \"feed.json\"\n  }`,\n  rssOutputFilename: `${removeLeadingSlash(prefix)}${\n    options.rssOutputFilename || \"rss.xml\"\n  }`,\n  rssXslFilename: `${removeLeadingSlash(prefix)}${\n    options.rssXslFilename || \"rss.xsl\"\n  }`,\n  rssXslTemplate: options.rssXslTemplate || `${TEMPLATE_FOLDER}rss.xsl`,\n});\n\nexport const getFeedLinks = (\n  { options: { base } }: App,\n  options: ResolvedFeedOptions,\n  localePath: string,\n): FeedLinks => {\n  const { hostname } = options;\n  const {\n    atomOutputFilename,\n    atomXslFilename,\n    jsonOutputFilename,\n    rssOutputFilename,\n    rssXslFilename,\n  } = getFilename(options, localePath);\n\n  return {\n    localePath,\n    atom: resolveUrl(hostname, base, atomOutputFilename),\n    atomXsl: resolveUrl(hostname, base, atomXslFilename),\n    json: resolveUrl(hostname, base, jsonOutputFilename),\n    rss: resolveUrl(hostname, base, rssOutputFilename),\n    rssXsl: resolveUrl(hostname, base, rssXslFilename),\n  };\n};\n","import type { App, Page } from \"@vuepress/core\";\nimport type { GitData } from \"@vuepress/plugin-git\";\nimport { colors, fs, path } from \"@vuepress/utils\";\nimport { entries, fromEntries } from \"vuepress-shared/node\";\n\nimport { Feed } from \"./feed.js\";\nimport { FeedInfo } from \"../extractor/index.js\";\nimport type { ResolvedFeedOptionsMap } from \"../options.js\";\nimport { getFeedChannelOption, getFeedLinks, getFilename } from \"../options.js\";\nimport type { FeedPluginFrontmatter } from \"../typings/index.js\";\nimport { logger } from \"../utils/index.js\";\n\nexport class FeedGenerator {\n  /** feed 生成器 */\n  feedMap: Record<string, Feed>;\n\n  constructor(\n    private app: App,\n    private options: ResolvedFeedOptionsMap,\n  ) {\n    this.feedMap = fromEntries(\n      entries(options).map(([localePath, localeOptions]) => [\n        localePath,\n        new Feed({\n          channel: getFeedChannelOption(app, localeOptions, localePath),\n          links: getFeedLinks(app, localeOptions, localePath),\n        }),\n      ]),\n    );\n  }\n\n  addPages(localePath: string): void {\n    const feed = this.feedMap[localePath];\n    const localeOption = this.options[localePath];\n    const { count: feedCount = 100, filter, sorter } = localeOption;\n    const pages = this.app.pages\n      .filter((page) => page.pathLocale === localePath)\n      .filter(filter)\n      .sort(sorter)\n      .slice(0, feedCount);\n\n    let count = 0;\n\n    for (const page of pages) {\n      const item = new FeedInfo(\n        this.app,\n        localeOption,\n        <Page<{ git?: GitData }, FeedPluginFrontmatter>>page,\n        feed,\n      ).getFeedItem();\n\n      if (item) {\n        feed.addItem(item);\n        count += 1;\n      }\n    }\n\n    logger.succeed(\n      `added ${colors.cyan(\n        `${count} page${count > 1 ? \"s\" : \"\"}`,\n      )} as feed item${count > 1 ? \"s\" : \"\"} in route ${colors.cyan(\n        localePath,\n      )}`,\n    );\n  }\n\n  async generateFeed(): Promise<void> {\n    const { dest } = this.app.dir;\n\n    await Promise.all([\n      ...entries(this.options).map(async ([localePath, localeOptions]) => {\n        // current locale has valid output\n        if (localeOptions.atom || localeOptions.json || localeOptions.rss) {\n          const feed = this.feedMap[localePath];\n          const { atomOutputFilename, jsonOutputFilename, rssOutputFilename } =\n            getFilename(localeOptions, localePath);\n\n          this.addPages(localePath);\n\n          // generate atom files\n          if (localeOptions.atom) {\n            await fs.ensureDir(path.dirname(dest(atomOutputFilename)));\n            await fs.outputFile(dest(atomOutputFilename), feed.atom());\n\n            logger.succeed(\n              `Atom feed file generated and saved to ${colors.cyan(\n                `/${atomOutputFilename}`,\n              )}`,\n            );\n          }\n\n          // generate json files\n          if (localeOptions.json) {\n            await fs.ensureDir(path.dirname(dest(jsonOutputFilename)));\n            await fs.outputFile(dest(jsonOutputFilename), feed.json());\n\n            logger.succeed(\n              `JSON feed file generated and saved to ${colors.cyan(\n                `/${jsonOutputFilename}`,\n              )}`,\n            );\n          }\n\n          // generate rss files\n          if (localeOptions.rss) {\n            await fs.ensureDir(path.dirname(dest(rssOutputFilename)));\n            await fs.outputFile(dest(rssOutputFilename), feed.rss());\n\n            logger.succeed(\n              `RSS feed file generated and saved to ${colors.cyan(\n                `/${rssOutputFilename}`,\n              )}`,\n            );\n          }\n        }\n      }),\n      entries(this.options)\n        .filter(([, { atom }]) => atom)\n        .map(([localePath, localeOptions]) => {\n          const { atomXslTemplate, atomXslFilename } = getFilename(\n            localeOptions,\n            localePath,\n          );\n\n          return fs.copyFile(atomXslTemplate, dest(atomXslFilename));\n        }),\n      entries(this.options)\n        .filter(([, { rss }]) => rss)\n        .map(([localePath, localeOptions]) => {\n          const { rssXslFilename, rssXslTemplate } = getFilename(\n            localeOptions,\n            localePath,\n          );\n\n          return fs.copyFile(rssXslTemplate, dest(rssXslFilename));\n        }),\n    ]);\n  }\n}\n","import type { App, HeadConfig } from \"@vuepress/core\";\nimport { keys } from \"vuepress-shared/node\";\n\nimport type { ResolvedFeedOptionsMap } from \"./options.js\";\nimport { getFilename } from \"./options.js\";\nimport { resolveUrl } from \"./utils/index.js\";\n\nexport const injectLinksToHead = (\n  app: App,\n  options: ResolvedFeedOptionsMap,\n): void => {\n  const { base } = app.options;\n  const { siteData } = app;\n  const localePaths = keys(options);\n\n  // there is only one language, so we append it to siteData\n  if (localePaths.length === 1) {\n    const { atomOutputFilename, jsonOutputFilename, rssOutputFilename } =\n      getFilename(options[\"/\"]);\n    const { atom, json, rss, hostname } = options[\"/\"];\n\n    const getHeadItem = (\n      name: string,\n      fileName: string,\n      type: string,\n    ): HeadConfig => [\n      \"link\",\n      {\n        rel: \"alternate\",\n        type,\n        href: resolveUrl(hostname, base, fileName),\n        title: `${\n          siteData.title || siteData.locales[\"/\"]?.title || \"\"\n        } ${name} Feed`,\n      },\n    ];\n\n    // ensure head exists\n    siteData.head ??= [];\n\n    // add atom link\n    if (atom)\n      siteData.head.push(\n        getHeadItem(\"Atom\", atomOutputFilename, \"application/atom+xml\"),\n      );\n\n    // add json link\n    if (json)\n      siteData.head.push(\n        getHeadItem(\"JSON\", jsonOutputFilename, \"application/json\"),\n      );\n\n    // add rss link\n    if (rss)\n      siteData.head.push(\n        getHeadItem(\"RSS\", rssOutputFilename, \"application/rss+xml\"),\n      );\n  }\n  // there are multiple languages, so we should append to page\n  else {\n    app.pages.forEach((page) => {\n      const { pathLocale } = page;\n      const localeOptions = options[pathLocale]!;\n\n      if (localePaths.includes(pathLocale)) {\n        const { atomOutputFilename, jsonOutputFilename, rssOutputFilename } =\n          getFilename(localeOptions, pathLocale);\n\n        const getHeadItem = (\n          name: string,\n          fileName: string,\n          type: string,\n        ): HeadConfig => [\n          \"link\",\n          {\n            rel: \"alternate\",\n            type,\n            href: resolveUrl(localeOptions.hostname, base, fileName),\n            title: `${\n              siteData.locales[pathLocale]?.title ||\n              siteData.title ||\n              siteData.locales[\"/\"]?.title ||\n              \"\"\n            } ${name} Feed`,\n          },\n        ];\n\n        // ensure head exists\n        page.frontmatter.head ??= [];\n\n        // add atom link\n        if (localeOptions.atom)\n          page.frontmatter.head.push(\n            getHeadItem(\"Atom\", atomOutputFilename, \"application/atom+xml\"),\n          );\n\n        // add json link\n        if (localeOptions.json)\n          page.frontmatter.head.push(\n            getHeadItem(\"JSON\", jsonOutputFilename, \"application/json\"),\n          );\n\n        // add rss link\n        if (localeOptions.rss)\n          page.frontmatter.head.push(\n            getHeadItem(\"RSS\", rssOutputFilename, \"application/rss+xml\"),\n          );\n      }\n    });\n  }\n};\n","import type { PluginFunction, PluginObject } from \"@vuepress/core\";\nimport { colors } from \"@vuepress/utils\";\nimport { checkVersion } from \"vuepress-shared/node\";\n\nimport { convertOptions } from \"./compact.js\";\nimport { FeedGenerator } from \"./generator/index.js\";\nimport { injectLinksToHead } from \"./injectHead.js\";\nimport { checkOutput, ensureHostName, getFeedOptions } from \"./options.js\";\nimport type { FeedOptions } from \"./typings/index.js\";\nimport { FEED_GENERATOR, logger } from \"./utils/index.js\";\n\nexport const feedPlugin =\n  (options: FeedOptions, legacy = true): PluginFunction =>\n  (app) => {\n    // TODO: Remove this in v2 stable\n    if (legacy)\n      convertOptions(options as FeedOptions & Record<string, unknown>);\n    checkVersion(app, FEED_GENERATOR, \"2.0.0-rc.0\");\n\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    const plugin: PluginObject = {\n      name: FEED_GENERATOR,\n    };\n\n    if (!ensureHostName(options)) {\n      logger.error(`Option ${colors.magenta(\"hostname\")} is required!`);\n\n      return plugin;\n    }\n\n    if (!checkOutput(options)) {\n      logger.info(\"No requested output, the plugin won’t start!\");\n\n      return plugin;\n    }\n\n    const feedOptions = getFeedOptions(app, options);\n\n    return {\n      ...plugin,\n\n      onInitialized: (app): void => injectLinksToHead(app, feedOptions),\n\n      onGenerated: (app): Promise<void> =>\n        new FeedGenerator(app, feedOptions).generateFeed(),\n    };\n  };\n"],"names":["convertOptions","options","deprecatedLogger","droppedLogger","createConverter","output","isPlainObject","encodeXML","content","fromEntries","entries","key","value","encodeXMLContent","encodeCDATA","isArray","item","FEED_GENERATOR","logger","Logger","resolveUrl","hostname","base","path","isLinkHttp","removeEndingSlash","removeLeadingSlash","getImageMineType","ext","getAuthor","author","name","email","url","genCategory","category","scheme","renderAtom","feed","channel","links","contributor","entry","js2xml","formatAuthor","renderJSON","channelAuthors","feedItem","domain","genGuid","guid","isUrl","genEnclosure","enclosure","renderRSS","hasContent","Feed","HEADING_TAGS","handleNode","node","isPreservedElement","src","isAbsoluteUrl","HTML_TAGS","SVG_TAGS","MATHML_TAGS","child","handleNodes","nodes","$","load","getPageRenderContent","app","page","pagePath","pageContent","fs","rootNodes","resolvedNode","FeedInfo","tagName","preservedElements","isFunction","pageText","getPageText","categories","getCategory","time","date","createdTime","updatedTime","getPageExcerpt","banner","cover","result","firstAuthor","copyright","description","excerpt","image","lastUpdated","link","pubDate","title","__dirname","getDirname","TEMPLATE_FOLDER","ensureEndingSlash","ensureHostName","checkOutput","values","atom","json","rss","getFeedOptions","siteData","keys","localePath","frontmatter","filePathRelative","pageA","pageB","compareDate","getFeedChannelOption","lang","locales","icon","authorName","defaultChannelOption","deepAssign","getFilename","prefix","getFeedLinks","atomOutputFilename","atomXslFilename","jsonOutputFilename","rssOutputFilename","rssXslFilename","FeedGenerator","localeOptions","localeOption","feedCount","filter","sorter","pages","count","colors","dest","atomXslTemplate","rssXslTemplate","injectLinksToHead","localePaths","getHeadItem","fileName","type","pathLocale","feedPlugin","legacy","checkVersion","plugin","feedOptions"],"mappings":"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"}